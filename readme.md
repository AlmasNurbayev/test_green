# Схема задания:

<image src="/public_images/schema.png" alt="Схема">
Текстовое ТЗ в конце данного readme

# Описание выполнения:

- 4 контейнера - (db) postrgres, (M1) и (M2) node.js 20, (rabbitmq) rabbitMQ-management

<image src="/public_images/containers.png" alt="Контейнеры">

- запуск через стандартный docker-compose -up
- важно - все настройки задаются через два env-файла:
  -- в корне .env (в репозитории приведен его пример .env.example)
  -- в M1/.env - строка подключения к БД (в репозитории приведен его пример .env.example)

# Как проверить:

- POST 45.146.167.130:7001/numbers и { value: 100 }
  <image src="/public_images/POST.png" alt="пример POST запроса">
- в любое время (но не ранее 5-10 секунд, задержка согласно ТЗ) получаем результат через GET 45.146.167.130:7001/numbers/{id} (какой-то id, полученный в POST)
- можно подключиться к веб-морде RMQ (http://45.146.167.130:15674/)
- в корне репо - коллекция postman, запускать те что с VPS. Файл test_green.postman_collection.json

# контейнер DB:

- стандартный контейнер Postrgres 16 с измененным портом
- можно снаружи подключаться через localhost:7501

## Что делает:

- Получает запросы от M1 для хранения в базе

# контейнер/микросервис M1:

- стек: node.js и nest.js, язык Typescript
- валидация, dto и сваггер на входящие данные, microservices с Trasport.RMQ. Следовательно много кода и зависимостей.
  ## что делает:
  - получает POST запросы на host:7001 с телом вида {"value": 180}
  - сохраняет в таблицу "numbers"
  - сразу возвращает пользователю ответ 200, его исходные данные плюс id присвоенный БД:
    {
    "id": 6,
    "value": 180,
    "created_at": "2023-12-23T11:36:50.908Z"
    }
  - отправляет сообщение в первую очередь RabbitMQ
  - слушает вторую очередь от M2, получает данные
  - полученное от M2 сообщение записывает в таблицу "numbers_received"
    При этом в таблице ответов записи ссылаются на входящую запись из первой таблицы, foreign key
  - как получить ответ? Через какое-то время направляем GET запрос со входящем id (localhost:7001/numbers/6)
    и получаем свой ответ:
    {
    "id": 2,
    "numbers_id": 6,
    "value": 360,
    "created_at": "2023-12-23T11:36:54.968Z"
    }
    <image src="/public_images/GET.png" alt="пример GET запроса">

# контейнер/микросервис M2:

- стек: node.js и amqplib, язык Typescript
- мало кода, мало зависимостей

## что делает:

- слушает входящую очередь RabbitMQ от M1
- получает объект вида {"value": 180}
- ждет 5 секунд, умножает value на 2, добавляет входящий numbers_id
- отправляет сообщение во вторую очередь RabbitMQ
- в консоль выводит входящее и исходящее сообщение, можно читать потом из логов докера

# Контейнер rabbitmq:

- стандартный контейнер с веб-интерфейсом
- можно на веб-морду подключаться через http://45.146.167.130:15674/

# Исходные требования:

1. Требуется разработать механизм асинхронной обработки HTTP запросов
2. Требуется использовать стек NodeJS, RabbitMQ
3. Требуется оформить в виде репозитория на Github
4. Требуется приложить инструкцию по локальному развертыванию проекта
5. Требуется реализовать логирование для целей отладки и мониторинга
6. Требуется разработать микросервис М1 для обработки входящих HTTP запросов
7. Требуется разработать микросервис М2 для обработки заданий из RabbitMQ
8. Требуется имитировать задержку обработки задания продолжительностью 5 секунд.
9. Требуется на вход системы подавать числовой параметр, а в качестве ответа получать удвоенное значение
   переданного параметра. Например, при передаче числа 5 ожидается получить в ответ число 10.
10. Требуется опубликовать разработанный сервис в Интернете для приема входящих POST запросов
    (желательно).
    Алгоритм работы:
    • Отправляем HTTP POST запрос на заданный URL.
    • Получаем HTTP запрос на уровне микросервиса М1.
    • Транслируем HTTP запрос в очередь RabbitMQ. Запрос трансформируется в задание.
    • Обрабатываем задание микросервисом М2 из очереди RabbitMQ в течение 5 секунд.
    • Помещаем результат обработки задания в RabbitMQ.
    • Возвращаем результат HTTP запроса как результат выполнения задания из RabbitMQ.
